{
    "sourceFile": "tests/cli_validator_new.rs",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1762037755634,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1762037755634,
            "name": "Commit-0",
            "content": "//! Tests for CLI validator\n\nuse clap::{Arg, Command};\nuse clap_noun_verb::cli::validator::ArgValidator;\nuse clap_noun_verb::error::{NounVerbError, Result};\n\n#[test]\nfn test_validator_new() {\n    let validator = ArgValidator::new();\n    // Validator should be created successfully\n    assert!(true); // Validator is zero-sized, just verify it compiles\n}\n\n#[test]\nfn test_validator_default() {\n    let validator = ArgValidator::default();\n    // Default should work\n    assert!(true);\n}\n\n#[test]\nfn test_validator_validate_required_str_success() -> Result<()> {\n    let validator = ArgValidator::new();\n    let cmd = Command::new(\"test\").arg(Arg::new(\"name\").required(true));\n\n    let matches = cmd\n        .try_get_matches_from(vec![\"test\", \"value\"])\n        .map_err(|e| NounVerbError::argument_error(e.to_string()))?;\n\n    let result = validator.validate_required_str(&matches, \"name\")?;\n    assert_eq!(result, \"value\");\n\n    Ok(())\n}\n\n#[test]\nfn test_validator_validate_required_str_missing() -> Result<()> {\n    let validator = ArgValidator::new();\n    let cmd = Command::new(\"test\").arg(Arg::new(\"name\").required(true));\n\n    let matches = cmd\n        .try_get_matches_from(vec![\"test\"])\n        .map_err(|e| NounVerbError::argument_error(e.to_string()));\n\n    // Should fail because required argument is missing\n    assert!(matches.is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_validator_validate_optional_str_present() -> Result<()> {\n    let validator = ArgValidator::new();\n    let cmd = Command::new(\"test\").arg(Arg::new(\"name\").long(\"name\"));\n\n    let matches = cmd\n        .try_get_matches_from(vec![\"test\", \"--name\", \"value\"])\n        .map_err(|e| NounVerbError::argument_error(e.to_string()))?;\n\n    let result = validator.validate_optional_str(&matches, \"name\");\n    assert_eq!(result, Some(\"value\".to_string()));\n\n    Ok(())\n}\n\n#[test]\nfn test_validator_validate_optional_str_missing() -> Result<()> {\n    let validator = ArgValidator::new();\n    let cmd = Command::new(\"test\").arg(Arg::new(\"name\"));\n\n    let matches = cmd\n        .try_get_matches_from(vec![\"test\"])\n        .map_err(|e| NounVerbError::argument_error(e.to_string()))?;\n\n    let result = validator.validate_optional_str(&matches, \"name\");\n    assert_eq!(result, None);\n\n    Ok(())\n}\n\n#[test]\nfn test_validator_validate_required_typed() -> Result<()> {\n    let validator = ArgValidator::new();\n    let cmd = Command::new(\"test\")\n        .arg(Arg::new(\"count\").required(true).value_parser(clap::value_parser!(usize)));\n\n    let matches = cmd\n        .try_get_matches_from(vec![\"test\", \"42\"])\n        .map_err(|e| NounVerbError::argument_error(e.to_string()))?;\n\n    let result: usize = validator.validate_required(&matches, \"count\")?;\n    assert_eq!(result, 42);\n\n    Ok(())\n}\n\n#[test]\nfn test_validator_validate_flag_set() -> Result<()> {\n    let validator = ArgValidator::new();\n    let cmd = Command::new(\"test\")\n        .arg(Arg::new(\"verbose\").long(\"verbose\").action(clap::ArgAction::SetTrue));\n\n    let matches = cmd\n        .try_get_matches_from(vec![\"test\", \"--verbose\"])\n        .map_err(|e| NounVerbError::argument_error(e.to_string()))?;\n\n    assert!(validator.validate_flag(&matches, \"verbose\"));\n\n    Ok(())\n}\n\n#[test]\nfn test_validator_validate_flag_not_set() -> Result<()> {\n    let validator = ArgValidator::new();\n    let cmd = Command::new(\"test\")\n        .arg(Arg::new(\"verbose\").long(\"verbose\").action(clap::ArgAction::SetTrue));\n\n    let matches = cmd\n        .try_get_matches_from(vec![\"test\"])\n        .map_err(|e| NounVerbError::argument_error(e.to_string()))?;\n\n    assert!(!validator.validate_flag(&matches, \"verbose\"));\n\n    Ok(())\n}\n\n#[test]\nfn test_validator_validate_flag_count() -> Result<()> {\n    let validator = ArgValidator::new();\n    let cmd = Command::new(\"test\")\n        .arg(Arg::new(\"verbose\").short('v').long(\"verbose\").action(clap::ArgAction::Count));\n\n    let matches = cmd\n        .try_get_matches_from(vec![\"test\", \"-vvv\"])\n        .map_err(|e| NounVerbError::argument_error(e.to_string()))?;\n\n    let count = validator.validate_flag_count(&matches, \"verbose\");\n    assert_eq!(count, 3);\n\n    Ok(())\n}\n\n#[test]\nfn test_validator_validate_many_success() -> Result<()> {\n    let validator = ArgValidator::new();\n    let cmd = Command::new(\"test\").arg(Arg::new(\"items\").required(true).num_args(1..));\n\n    let matches = cmd\n        .try_get_matches_from(vec![\"test\", \"item1\", \"item2\", \"item3\"])\n        .map_err(|e| NounVerbError::argument_error(e.to_string()))?;\n\n    let result: Vec<String> = validator.validate_many(&matches, \"items\")?;\n    assert_eq!(result.len(), 3);\n    assert_eq!(result[0], \"item1\");\n    assert_eq!(result[1], \"item2\");\n    assert_eq!(result[2], \"item3\");\n\n    Ok(())\n}\n\n#[test]\nfn test_validator_validate_many_empty() -> Result<()> {\n    let validator = ArgValidator::new();\n    let cmd = Command::new(\"test\").arg(Arg::new(\"items\").required(true).num_args(1..));\n\n    let matches = cmd\n        .try_get_matches_from(vec![\"test\"])\n        .map_err(|e| NounVerbError::argument_error(e.to_string()));\n\n    // Should fail because required argument is missing\n    assert!(matches.is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_validator_validate_many_opt_empty() -> Result<()> {\n    let validator = ArgValidator::new();\n    let cmd = Command::new(\"test\").arg(Arg::new(\"items\").num_args(1..));\n\n    let matches = cmd\n        .try_get_matches_from(vec![\"test\"])\n        .map_err(|e| NounVerbError::argument_error(e.to_string()))?;\n\n    let result: Vec<String> = validator.validate_many_opt(&matches, \"items\");\n    assert_eq!(result.len(), 0);\n\n    Ok(())\n}\n\n#[test]\nfn test_validator_extract_args() -> Result<()> {\n    let validator = ArgValidator::new();\n    let cmd = Command::new(\"test\")\n        .arg(Arg::new(\"name\").required(true))\n        .arg(Arg::new(\"value\").required(true));\n\n    let matches = cmd\n        .try_get_matches_from(vec![\"test\", \"test-name\", \"test-value\"])\n        .map_err(|e| NounVerbError::argument_error(e.to_string()))?;\n\n    let args = validator.extract_args(&matches);\n\n    // Should extract both arguments\n    assert!(args.len() >= 2);\n    assert_eq!(args.get(\"name\"), Some(&\"test-name\".to_string()));\n    assert_eq!(args.get(\"value\"), Some(&\"test-value\".to_string()));\n\n    Ok(())\n}\n\n#[test]\nfn test_validator_extract_opts() -> Result<()> {\n    let validator = ArgValidator::new();\n    let cmd = Command::new(\"test\")\n        .arg(Arg::new(\"verbose\").long(\"verbose\").action(clap::ArgAction::SetTrue));\n\n    let matches = cmd\n        .try_get_matches_from(vec![\"test\", \"--verbose\"])\n        .map_err(|e| NounVerbError::argument_error(e.to_string()))?;\n\n    let opts = validator.extract_opts(&matches);\n\n    // Should extract flags (Count actions are not extracted by extract_opts - they need get_count)\n    assert!(opts.len() >= 1);\n\n    Ok(())\n}\n"
        }
    ]
}